<!doctype html>

<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Crashlog Reader</title>
  <style>
  	#output, #backBtn, .footer-note {
  opacity: 0;
  display: none;
  pointer-events: none;
}

#output.show, #backBtn.show, .footer-note.show {
  display: block;
  animation: fadeIn 0.8s forwards;
  pointer-events: auto;
}

#backBtn.show { display: inline-block; } /* biar tombol tetap inline */

#output.hide, #backBtn.hide, .footer-note.hide {
  animation: fadeOut 0.8s forwards;
  pointer-events: none;
}
    @font-face {
      font-family: 'BebasNeue';
      src: url('./BebasNeue-Regular.ttf') format('truetype');
    }
    @font-face {
      font-family: 'Sequel100Black';
      src: url('./Sequel100Black-76.ttf') format('truetype');
    }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #000;
      color: #fff;
      min-height: 100vh;
      text-align: center;
      display: flex;
      justify-content: center;
      align-items: center;
    }.menu-wrapper {
  transform: translateY(30px);
}

.container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
}

h1 {
  margin-bottom: 8px;
  font-family: 'Sequel100Black', sans-serif;
  font-size: 1.5rem;
  line-height: 1.2;
  text-shadow: 2px 2px 5px rgba(0,0,0,0.7);
}

.uploader {
  margin: 20px 0 10px 0;
}

.actions {
  margin-top: 15px;
}

input[type="file"] {
  padding: 10px;
  border-radius: 8px;
  border: none;
  background: #111;
  color: #fff;
}

button {
  padding: 10px 20px;
  border-radius: 8px;
  border: 0;
  font-weight: 700;
  color: #fff;
  background: #2563eb;
  cursor: pointer;
  box-shadow: 0 4px 10px rgba(0,0,0,0.4);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  font-family: Arial, sans-serif;
}
button:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 14px rgba(0,0,0,0.5);
}
button:active {
  transform: scale(0.97);
  box-shadow: 0 2px 6px rgba(0,0,0,0.4);
}

#cornerLogo {
  position: absolute;
  top: 0;
  right: 0;
  height: 100px;
  width: auto;
  opacity: 1;
  transition: opacity 1s ease;
  pointer-events: none;
}

#output-wrapper {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-top: 10px;
  transform: translateY(-80px);
}

#output {
  background: #111;
  padding: 15px;
  border-radius: 12px;
  width: 90vw;
  max-width: 100vw;
  max-height: 70vh;
  overflow-y: auto;
  white-space: pre-wrap;
  text-align: left;
  opacity: 0;
  transition: opacity 0.8s ease;
  font-size: 14px;
  line-height: 1.5;
  pointer-events: none;
  display: none;
}
#output.show {
  opacity: 1;
  pointer-events: auto;
  display: block;
}

#backBtn {
  margin-top: 12px;
  background: #2563eb;
  opacity: 0;
  transition: opacity 0.8s ease;
  display: none;
  pointer-events: none;
}
#backBtn.show {
  display: inline-block;
  opacity: 1;
  pointer-events: auto;
}

.footer-note {
  margin-top: 6px;
  font-size: 14px;
  color: #888;
  font-family: 'BebasNeue', sans-serif;
  text-align: center;
  opacity: 0;
  transition: opacity 0.8s ease;
  display: none;
  pointer-events: none;
}
.footer-note.show {
  display: block;
  opacity: 1;
  pointer-events: auto;
}

.fadeout { animation: fadeOut 0.8s forwards; pointer-events: none; }
.fadein  { animation: fadeIn  0.8s forwards; }
@keyframes fadeOut { from {opacity: 1;} to {opacity: 0;} }
@keyframes fadeIn  { from {opacity: 0;} to {opacity: 1;} }

#fileError, #uploadWarning {
  color: #f87171;
  margin-top: 10px;
  font-size: 14px;
  display: none;
}

.highlight-error { color: rgb(255,36,36); font-weight: bold; }
.highlight-problem { color: rgb(255,160,36); font-weight: bold; }
.highlight-solution { color: rgb(168,255,5); font-weight: bold; }
.highlight-note { color: rgb(214,214,214); font-style: italic; }

.credit {
  margin-top: 6px;
  font-size: 13px;
  color: #888;
  font-family: 'BebasNeue', sans-serif;
}

  </style>
</head>
<body>
  <img src="back8.png" id="cornerLogo" alt="Logo GTA" />
  <div class="container">
    <div class="menu-wrapper">
      <h1 id="title">Crashlog Reader</h1>
      <div class="uploader" id="uploader">
        <label for="fileInput">Upload file crashlog disini</label><br>
        <input type="file" id="fileInput" accept=".txt">
        <div id="fileError">File yang diupload tidak sesuai!</div>
        <div id="uploadWarning">Harap upload file aml_crashlog.txt terlebih dahulu.</div>
      </div>
      <div class="actions" id="actions">
        <button id="startBtn">Mulai</button>
        <div class="credit">- TwentySeven -</div>
      </div>
    </div>
    <div id="output-wrapper">
      <div id="output"></div>
      <div id="footerNote" class="footer-note">
        Documented by ARM<br>15/07/2024
      </div>
      <button id="backBtn"></button>
    </div>
  </div>  <script>
    let crashList = {};
    let crashLogContent = "";
    let currentTexts = {};

    const logoEl = document.getElementById('cornerLogo');
    const logoImages = ['back5.png','back6.png','back7.png','back8.png'];
    let logoIdx = 0;
    logoImages.forEach(src => { const img = new Image(); img.src = src; });
    function swapLogo() {
      logoIdx = (logoIdx + 1) % logoImages.length;
      logoEl.classList.add('fadeout');
      setTimeout(() => {
        logoEl.src = logoImages[logoIdx];
        logoEl.classList.remove('fadeout');
        logoEl.classList.add('fadein');
        setTimeout(() => logoEl.classList.remove('fadein'), 800);
      }, 300);
    }
    let logoTimer = setInterval(swapLogo, 4000);

    function showTempMessage(el){
      el.style.display = 'block';
      el.classList.remove('fadeout');
      void el.offsetWidth;
      setTimeout(()=>{
        el.classList.add('fadeout');
        setTimeout(()=>{el.style.display='none';},3000);
      },3000);
    }

    async function loadCrashList(){
      try {
        const lang = navigator.language || navigator.userLanguage || '';
        let fileName = lang.startsWith('id') ? 'Crash_List - 2.00 ID.txt' : 'Crash_List - 2.00.txt';
        const res = await fetch(fileName);
        const text = await res.text();
        parseCrashList(text);
      } catch(e){ console.error('Gagal load Crash_List:', e); }
    }

    function parseCrashList(text){
      const normalized = text.replace(/\r\n/g, '\n');
      const blockRegex = /(^\s*(?:Error:|Kesalahan:)[\s\S]*?)(?=^\s*(?:Error:|Kesalahan:)|\Z)/gm;
      const blocks = normalized.match(blockRegex) || [];
      blocks.forEach(block => {
        const lines = block.replace(/\n+$/,'').split('\n');
        const codeLine = lines.find(l => /0x[0-9A-Fa-f]+/.test(l)) || '';
        const codes = (codeLine.match(/0x[0-9A-Fa-f]+/g) || []).map(c => c.trim());
        codes.forEach(code => crashList[code] = lines);
      });
    }

    function renderCrashLines(lines){
      const out = document.getElementById('output');
      const backBtn = document.getElementById('backBtn');
      out.innerHTML = '';

      let lineIndex = 0, charIndex = 0;
      let currentTextNode = null;
      let lastDetails = null; // grup Problem/Solution aktif

      function classifyAndBuild(line){
  const container = document.createElement('div');
  const m = line.match(/^[^:]+:/);

  if(m){
    const label = m[0];
    const rest = line.slice(label.length).trim();
    const labelLower = label.toLowerCase();

    // === Problem ===
    if(labelLower.includes('problem') || labelLower.includes('masalah')){
      const details = document.createElement('details');
      const summary = document.createElement('summary');
      summary.textContent = label;
      summary.className = 'highlight-problem';
      details.appendChild(summary);

      const content = document.createElement('div');
      content.style.marginLeft = "12px";
      content.textContent = rest;
      details.appendChild(content);

      lastDetails = details;
      lastDetails.lastContent = content;
      return {container: details, textToType: null, skipTyping: true};
    }

    // === Solution ===
    if(labelLower.includes('solution') || labelLower.includes('solusi')){
      const solDetails = document.createElement('details');
      const solSummary = document.createElement('summary');
      solSummary.textContent = label;
      solSummary.className = 'highlight-solution';
      solDetails.appendChild(solSummary);

      const content = document.createElement('div');
      content.style.marginLeft = "12px";
      content.textContent = rest;
      solDetails.appendChild(content);
      solDetails.lastContent = content;

      if(lastDetails){
        // masukkan solution ke dalam Problem terakhir
        lastDetails.appendChild(solDetails);
      }

      lastDetails = solDetails; // supaya bisa nyambung multi-baris
      return {container: document.createDocumentFragment(), textToType: null, skipTyping: true};
    }

    // === Error ===
    if(labelLower.includes('error') || labelLower.includes('kesalahan')){
      const spanLabel = document.createElement('span');
      spanLabel.className = 'highlight-error';
      spanLabel.textContent = label;

      const spanCode = document.createElement('span');
      spanCode.style.color = '#ffffff';
      if(rest) spanCode.textContent = " " + rest;

      container.appendChild(spanLabel);
      container.appendChild(spanCode);

      lastDetails = null;
      return {container, textToType: null, skipTyping: true};
    }

    // === Note / FYI ===
    if(labelLower.includes('fyi') || labelLower.includes('note') || labelLower.includes('catatan')){
      const note = document.createElement('div');
      note.style.marginLeft = "12px";
      note.textContent = label + " " + rest;

      if(lastDetails){
        lastDetails.appendChild(note);
        return {container: document.createDocumentFragment(), textToType: null, skipTyping: true};
      } else {
        container.appendChild(note);
        return {container, textToType: null, skipTyping: true};
      }
    }

    // fallback
    const span = document.createElement('span');
    span.textContent = label;
    container.appendChild(span);
    currentTextNode = document.createTextNode('');
    container.appendChild(currentTextNode);
    return {container, textToType: rest};
  }

  // === Baris tanpa label, sambung ke blok terakhir ===
  if(lastDetails){
    if(line.trim() !== ""){
      if(lastDetails.lastContent){
        lastDetails.lastContent.textContent += " " + line.trim();
      } else {
        const extra = document.createElement('div');
        extra.style.marginLeft = "12px";
        extra.textContent = line.trim();
        lastDetails.appendChild(extra);
        lastDetails.lastContent = extra;
      }
    }
    return {container: document.createDocumentFragment(), textToType: null, skipTyping: true};
  }

  // fallback biasa
  currentTextNode = document.createTextNode('');
  container.appendChild(currentTextNode);
  return {container, textToType: line};
}

      function nextLine(){
        if(lineIndex >= lines.length){
          document.getElementById('footerNote').classList.add('show');
backBtn.textContent = currentTexts.backBtn;
backBtn.classList.add('show'); // langsung, biar barengan sama footer
          return;
        }
        const raw = lines[lineIndex];
        const {container, textToType} = classifyAndBuild(raw);
        out.appendChild(container);
        charIndex = 0;
        typeChars(currentTextNode, textToType || '', () => { lineIndex++; nextLine(); });
      }

      function typeChars(node, text, done){
  node.textContent = text;
  done();
}

      nextLine();
    }

    function setUIText(lang){
      let texts = {
        uploadWarning: 'Harap upload file aml_crashlog.txt terlebih dahulu.',
        uploadLabel:   'Upload file crashlog disini',
        fileError:     'File yang diupload tidak sesuai!',
        startBtn:      'Mulai',
        backBtn:      'Kembali',
        notFound:      'Tidak ditemukan kode crash yang cocok.'
      };
      if((lang||'').startsWith('en')){
        texts = {
          uploadWarning: 'Please upload aml_crashlog.txt first.',
          uploadLabel:   'Upload crashlog file here',
          fileError:     'The uploaded file is not valid!',
          startBtn:      'Start',
          backBtn:      'Back',
          notFound:      'No matching crash code found.'
        };
      }
      currentTexts = texts;
      document.querySelector("label[for='fileInput']").textContent = texts.uploadLabel;
      document.getElementById('fileError').textContent = texts.fileError;
      document.getElementById('uploadWarning').textContent = texts.uploadWarning;
      document.getElementById('startBtn').textContent = texts.startBtn;
    }

    document.getElementById('fileInput').addEventListener('change', function(e){
      const file = e.target.files[0];
      const fileError = document.getElementById('fileError');
      const uploadWarning = document.getElementById('uploadWarning');
      if(file){
        if(file.name !== 'aml_crashlog.txt'){
          showTempMessage(fileError);
          crashLogContent = '';
          uploadWarning.style.display = 'none';
          return;
        }
        fileError.style.display = 'none';
        uploadWarning.style.display = 'none';
        const reader = new FileReader();
        reader.onload = ev => { crashLogContent = ev.target.result; };
        reader.readAsText(file);
      }
    });

    document.getElementById('startBtn').addEventListener('click', ()=>{
  const out = document.getElementById('output');
  const uploadWarning = document.getElementById('uploadWarning');
  const footer = document.getElementById('footerNote');
  const title = document.getElementById('title');
  const uploader = document.getElementById('uploader');
  const actions = document.getElementById('actions');
  const backBtn = document.getElementById('backBtn');
  const fileInput = document.getElementById('fileInput');

  // Reset tampilan hasil
  out.classList.remove('show');
  out.innerHTML = '';
  footer.classList.remove('show');
  backBtn.classList.remove('show');

  // === VALIDASI WAJIB: file harus ada dan bernama benar ===
  const hasChosenFile = fileInput && fileInput.files && fileInput.files.length > 0;
  const isRightName = hasChosenFile && fileInput.files[0].name === 'aml_crashlog.txt';
  const hasContent = !!crashLogContent;

  if (!hasChosenFile || !isRightName || !hasContent) {
    showTempMessage(uploadWarning);
    return; // stop di sini: JANGAN fade out menu
  }

  // Lolos validasi â†’ jalankan animasi keluar menu
  title.classList.add('fadeout');
  uploader.classList.add('fadeout');
  actions.classList.add('fadeout');

  setTimeout(()=>{
    out.classList.add('show');

    let found = false;
    for (const code in crashList) {
      if (crashLogContent.includes(code)) {
        renderCrashLines(crashList[code]);
        found = true;
        break;
      }
    }

    if (!found) {
      out.textContent = currentTexts.notFound;
      footer.classList.add('show');
      backBtn.textContent = currentTexts.backBtn;
      setTimeout(() => backBtn.classList.add('show'), 100);
    }
  }, 1000);
});

    document.getElementById('backBtn').addEventListener('click', ()=>{
  const out = document.getElementById('output');
  const footer = document.getElementById('footerNote');
  const title = document.getElementById('title');
  const uploader = document.getElementById('uploader');
  const actions = document.getElementById('actions');
  const backBtn = document.getElementById('backBtn');
  const fileInput = document.getElementById('fileInput');
  const fileError = document.getElementById('fileError');
  const uploadWarning = document.getElementById('uploadWarning');

  // Sembunyikan hasil pakai fade out
out.classList.remove('show');
out.classList.add('hide');
backBtn.classList.remove('show');
backBtn.classList.add('hide');
footer.classList.remove('show');
footer.classList.add('hide');

setTimeout(()=>{
  out.classList.remove('hide');
  backBtn.classList.remove('hide');
  footer.classList.remove('hide');
}, 800); // biar reset setelah animasi selesai

  // === RESET STATE FILE ===
  crashLogContent = '';
  if (fileInput) fileInput.value = '';
  if (fileError) fileError.style.display = 'none';
  if (uploadWarning) uploadWarning.style.display = 'none';

  // Setelah 0.8s tampilkan menu awal lagi
  setTimeout(()=>{
    title.classList.remove('fadeout');
    uploader.classList.remove('fadeout');
    actions.classList.remove('fadeout');

    title.classList.add('fadein');
    uploader.classList.add('fadein');
    actions.classList.add('fadein');

    setTimeout(()=>{
      title.classList.remove('fadein');
      uploader.classList.remove('fadein');
      actions.classList.remove('fadein');
    }, 400);
  }, 400);
});

    setUIText(navigator.language || '');
    loadCrashList();
  </script></body>
</html>